

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10. Spring Boot Entity</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11. Spring Data JPA" href="jpa.html" />
    <link rel="prev" title="9. Spring Boot Pages" href="pages.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Spring-Cloud
          

          
            
            <img src="../_static/icon-Spring-Cloud.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">目录:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">1. 教学计划</a></li>
<li class="toctree-l1"><a class="reference internal" href="maven.html">2. 初识 Maven</a></li>
<li class="toctree-l1"><a class="reference internal" href="git.html">3. 初识 Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">4. 初识 Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">5. Spring Boot CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="springboot.html">6. Spring Boot 2.x 学习</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller.html">7. Spring Boot Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="service.html">8. Spring Boot Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="pages.html">9. Spring Boot Pages</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">10. Spring Boot Entity</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">10.1. 概要</a></li>
<li class="toctree-l2"><a class="reference internal" href="#entity">10.2. Entity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#annotation">10.2.1. Annotation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id">10.2.1.1. &#64;Id</a></li>
<li class="toctree-l4"><a class="reference internal" href="#createddate">10.2.1.2. &#64;CreatedDate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#column">10.2.1.3. &#64;Column</a></li>
<li class="toctree-l4"><a class="reference internal" href="#transient">10.2.1.4. &#64;Transient</a></li>
<li class="toctree-l4"><a class="reference internal" href="#temporal">10.2.1.5. &#64;Temporal</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enumerated">10.2.1.6. &#64;Enumerated</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id2">10.3. 日期处理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">10.3.1. 配置文件中配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jsonformat">10.3.2. &#64;JsonFormat</a></li>
<li class="toctree-l3"><a class="reference internal" href="#datetimeformat">10.3.3. &#64;DateTimeFormat</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">10.3.4. &#64;Temporal</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#relationship">10.4. Relationship</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#one-to-one">10.4.1. one-to-one</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#foreign-key">10.4.1.1. Foreign Key</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shared-primary-key">10.4.1.2. Shared Primary Key(推荐)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#join-table">10.4.1.3. Join Table</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#one-to-many">10.4.2. one-to-many</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id7">10.4.2.1. Unidirectional</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unidirectional-with-joincolumn">10.4.2.2. Unidirectional with &#64;JoinColumn</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">10.4.2.3. Bidirectional(推荐)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#many-to-many">10.4.3. many-to-many</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#h2">10.5. H2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">10.5.1. 默认配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">10.5.2. 更改H2控制台的路径</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id11">10.6. 初始化数据库数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">10.7. 参考</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jpa.html">11. Spring Data JPA</a></li>
<li class="toctree-l1"><a class="reference internal" href="springdatarest.html">12. Spring Data REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="redis.html">13. Spring Boot Redis</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongodb.html">14. Spring Boot MongoDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="slf4j.html">15. SLF4J</a></li>
<li class="toctree-l1"><a class="reference internal" href="autoconfiguration.html">16. Spring Boot Auto-Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">17. Spring Boot Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="actuator.html">18. Spring Boot Actuator</a></li>
<li class="toctree-l1"><a class="reference internal" href="restful.html">19. Spring Boot RESTful</a></li>
<li class="toctree-l1"><a class="reference internal" href="swagger.html">20. Springfox-Swagger2</a></li>
<li class="toctree-l1"><a class="reference internal" href="springcloud.html">21. Spring Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="springcloudconfig.html">22. Spring Cloud Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="netflix.html">23. Spring Cloud Netflix</a></li>
<li class="toctree-l1"><a class="reference internal" href="eureka.html">24. Spring Cloud Eureka</a></li>
<li class="toctree-l1"><a class="reference internal" href="feign.html">25. Spring Cloud Feign</a></li>
<li class="toctree-l1"><a class="reference internal" href="zuul.html">26. Spring Cloud Zuul</a></li>
<li class="toctree-l1"><a class="reference internal" href="elk.html">27. ELK</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">28. Kubernetes学习</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment.html">29. Assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="sphinx.html">30. Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="interview.html">31. Spring Cloud Interview</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spring-Cloud</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">首页</a> &raquo;</li>
        
      <li><span class="section-number">10. </span>Spring Boot Entity</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spring-boot-entity">
<h1><span class="section-number">10. </span>Spring Boot Entity<a class="headerlink" href="#spring-boot-entity" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2><span class="section-number">10.1. </span>概要<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>JPA中的实体(Entity)就是是POJO，代表可以持久保存到数据库里的数据。 实体表示存储在数据库中的表。 实体的每个实例都对应表中的一行。</p>
</div>
<div class="section" id="entity">
<h2><span class="section-number">10.2. </span>Entity<a class="headerlink" href="#entity" title="Permalink to this headline">¶</a></h2>
<p>实体(Entity)中必须要有一个无参的构造函数和一个主键:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@Entity</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Student&quot;</span><span class="p">)</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;STUDENT&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;SCHOOL&quot;</span><span class="p">)</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">Student</span> <span class="p">{</span>

    <span class="nd">@CreatedDate</span>
    <span class="n">private</span> <span class="n">Date</span> <span class="n">creationDate</span><span class="p">;</span>

    <span class="nd">@LastModifiedDate</span>
    <span class="n">private</span> <span class="n">Date</span> <span class="n">modificationDate</span><span class="p">;</span>

    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;STUDENT_NAME&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="n">false</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="n">false</span><span class="p">)</span>
    <span class="n">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">fields</span><span class="p">,</span> <span class="n">getters</span> <span class="ow">and</span> <span class="n">setters</span>

<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Entity名称默认为类的名称，可以使用name元素更改其名称。name对应HQL里面的查询Entity。</p></li>
<li><p>Table名称默认为类的名称，可以使用name元素更改其名称。name对应DB里面的表名。</p></li>
<li><p>因为各种JPA实现都将尝试对我们的Entity进行子类化以提供其功能，所以不得将Entity类声明为final。</p></li>
<li><p>每个Entity都必须具有一个唯一标识它的主键。</p></li>
</ul>
<div class="admonition- admonition">
<p class="admonition-title">默认构造函数</p>
<p>如果没有创建构造函数，则Java编译器将在运行时自动创建无参数构造函数。 此构造函数称为默认构造函数。 默认构造函数将初始化所有未初始化的实例变量。</p>
</div>
<div class="section" id="annotation">
<h3><span class="section-number">10.2.1. </span>Annotation<a class="headerlink" href="#annotation" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id">
<h4><span class="section-number">10.2.1.1. </span>&#64;Id<a class="headerlink" href="#id" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">User</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="n">AUTO</span><span class="p">)</span>
    <span class="n">private</span> <span class="n">long</span> <span class="nb">id</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">private</span> <span class="n">UUID</span> <span class="nb">id</span><span class="p">;</span>

    <span class="nd">@Id</span>
    <span class="nd">@GenericGenerator</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;idGenerator&quot;</span><span class="p">,</span> <span class="n">strategy</span> <span class="o">=</span> <span class="s2">&quot;uuid&quot;</span><span class="p">)</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">generator</span> <span class="o">=</span> <span class="s2">&quot;idGenerator&quot;</span><span class="p">)</span>
    <span class="n">private</span> <span class="n">String</span> <span class="nb">id</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">getters</span> <span class="ow">and</span> <span class="n">setters</span>
<span class="p">}</span>
</pre></div>
</div>
<p>JPA自带的几种主键生成策略:</p>
<ol class="arabic simple">
<li><p>TABLE： 使用一个特定的数据库表格来保存主键</p></li>
<li><p>SEQUENCE： 根据底层数据库的序列来生成主键，条件是数据库支持序列。这个值要与generator一起使用，generator 指定生成主键使用的生成器（可能是orcale中自己编写的序列）</p></li>
<li><p>IDENTITY： 主键由数据库自动生成（主要是支持自动增长的数据库，如mysql）</p></li>
<li><p>AUTO： 主键由程序控制，也是GenerationType的默认值</p></li>
</ol>
</div>
<div class="section" id="createddate">
<h4><span class="section-number">10.2.1.2. </span>&#64;CreatedDate<a class="headerlink" href="#createddate" title="Permalink to this headline">¶</a></h4>
<p>需要在Entity上添加&#64;EntityListeners标签，以及在Configuration类上添加&#64;EnableJpaAuditing标签，如下所示：</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Student&quot;</span><span class="p">)</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;STUDENT&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="s">&quot;SCHOOL&quot;</span><span class="p">)</span>
<span class="nd">@EntityListeners</span><span class="p">(</span><span class="n">AuditingEntityListener</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Student</span> <span class="p">{</span>

    <span class="nd">@CreatedDate</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">creationDate</span><span class="p">;</span>

    <span class="nd">@LastModifiedDate</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">modificationDate</span><span class="p">;</span>

    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;STUDENT_NAME&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>

    <span class="c1">// fields, getters and setters</span>

<span class="p">}</span>

<span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableJpaAuditing</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemoApplication</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">DemoApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="column">
<h4><span class="section-number">10.2.1.3. </span>&#64;Column<a class="headerlink" href="#column" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;STUDENT&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Student</span> <span class="p">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">GenerationType</span><span class="p">.</span><span class="na">AUTO</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;STUDENT_NAME&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>

    <span class="c1">// other fields, getters and setters</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="transient">
<h4><span class="section-number">10.2.1.4. </span>&#64;Transient<a class="headerlink" href="#transient" title="Permalink to this headline">¶</a></h4>
<p>有时，我们可能希望将字段设为非持久性。 我们可以使用&#64;Transient注解，它指定该字段将不会持久化到数据库。如Entity中同时有个出生年月和年龄2个字段，一般情况下，仅需要将出生年月持久化到数据库，年龄字段作为逻辑字段，不持久化到数据库。</p>
</div>
<div class="section" id="temporal">
<h4><span class="section-number">10.2.1.5. </span>&#64;Temporal<a class="headerlink" href="#temporal" title="Permalink to this headline">¶</a></h4>
<p>&#64;Temporal的作用是查询时，返回的字段值按照指定日期的格式显示，示例：</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;STUDENT&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Student</span> <span class="p">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">GenerationType</span><span class="p">.</span><span class="na">AUTO</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="p">;</span>

    <span class="nd">@Temporal</span><span class="p">(</span><span class="n">TemporalType</span><span class="p">.</span><span class="na">DATE</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">birthDate</span><span class="p">;</span>

    <span class="c1">// other fields, getters and setters</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>TemporalType有这么几种值： java.time.LocalDate, java.time.LocalTime, java.time.LocalDateTime, java.time.OffsetTime 和 java.time.OffsetDateTime.</p>
<ol class="arabic simple">
<li><p>在该属性上标注&#64;Temporal(TemporalType.DATE) 会得到形如’yyyy-MM-dd’ 格式的日期。</p></li>
<li><p>在该属性上标注 &#64;Temporal(TemporalType.TIME) 会得到形如’HH:MM:SS’ 格式的日期。</p></li>
<li><p>在该属性上标注 &#64;Temporal(TemporalType.TIMESTAMP) 会得到形如’HH:MM:SS’ 格式的日期。</p></li>
</ol>
</div>
<div class="section" id="enumerated">
<h4><span class="section-number">10.2.1.6. </span>&#64;Enumerated<a class="headerlink" href="#enumerated" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Gender</span> <span class="p">{</span>
    <span class="n">MALE</span><span class="p">,</span>
    <span class="n">FEMALE</span>
<span class="p">}</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;STUDENT&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Student</span> <span class="p">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">GenerationType</span><span class="p">.</span><span class="na">AUTO</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;STUDENT_NAME&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>

    <span class="nd">@Transient</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="p">;</span>

    <span class="nd">@Temporal</span><span class="p">(</span><span class="n">TemporalType</span><span class="p">.</span><span class="na">DATE</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">birthDate</span><span class="p">;</span>

    <span class="nd">@Enumerated</span><span class="p">(</span><span class="n">EnumType</span><span class="p">.</span><span class="na">STRING</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Gender</span> <span class="n">gender</span><span class="p">;</span>

    <span class="c1">// other fields, getters and setters</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="id2">
<h2><span class="section-number">10.3. </span>日期处理<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Spring Boot中未设置日期格式之前，前端接收到的时间戳：createTime：1425300054855</p>
<p>有下面几种方式指定日期格式：</p>
<div class="section" id="id3">
<h3><span class="section-number">10.3.1. </span>配置文件中配置<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spring</span><span class="o">.</span><span class="n">jacksondate</span><span class="o">-</span><span class="nb">format</span> <span class="o">=</span> <span class="n">yyyy</span><span class="o">-</span><span class="n">MM</span><span class="o">-</span><span class="n">dd</span> <span class="n">HH</span><span class="p">:</span><span class="n">mm</span><span class="p">:</span><span class="n">ss</span>
</pre></div>
</div>
</div>
<div class="section" id="jsonformat">
<h3><span class="section-number">10.3.2. </span>&#64;JsonFormat<a class="headerlink" href="#jsonformat" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@JsonFormat</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s">&quot;yyyy-MM-dd HH:mm&quot;</span><span class="p">)</span>
<span class="kd">private</span> <span class="n">Date</span> <span class="n">createTime</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="datetimeformat">
<h3><span class="section-number">10.3.3. </span>&#64;DateTimeFormat<a class="headerlink" href="#datetimeformat" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@DateTimeFormat</span><span class="p">(</span><span class="n">pattern</span> <span class="o">=</span> <span class="s">&quot;yyyy-MM-dd&quot;</span><span class="p">)</span>
<span class="kd">private</span> <span class="n">Date</span> <span class="n">createTime</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>&#64;DateTimeFormat 格式化日期需要注意的是：使用时要引入一个类库joda-time-1.3.jar，否则会无法访问相应路径(400错误)。</p>
</div>
<div class="section" id="id4">
<h3><span class="section-number">10.3.4. </span>&#64;Temporal<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>详细内容参照上面的&#64;Temporal讲解部分。</p>
</div>
</div>
<div class="section" id="relationship">
<h2><span class="section-number">10.4. </span>Relationship<a class="headerlink" href="#relationship" title="Permalink to this headline">¶</a></h2>
<p>JPA关系可以是单向或双向的。这只是意味着我们可以将它们的关系建模在实体属性的一方或者双方。主要区别在于，双向关系提供了双向导航访问，因此您无需显式查询即可访问另一侧。此外，它还允许您在两个方向上应用级联选项。
定义实体之间关系的方向不会影响数据库映射，它仅定义了在域模型中使用该关系的方向，节省了维护代码的成本。</p>
<p>模型关系的定义可能会迫使数据库创建除表之外的其他资源，如索引，触发器等。</p>
<ul class="simple">
<li><p>&#64;JoinColumn注解指定用于连接关联的实体或元素的集合，它声明在Owner方。</p></li>
<li><p>mappedBy属性用于定义关系维护的refering方（non-owning side）。</p></li>
<li><p>mappedBy与&#64;JoinColumn和&#64;JoinTable互斥，不能同时作用于同一个属性上。</p></li>
</ul>
<div class="section" id="one-to-one">
<h3><span class="section-number">10.4.1. </span>one-to-one<a class="headerlink" href="#one-to-one" title="Permalink to this headline">¶</a></h3>
<p>本文将介绍3种方式描述JPA的一对一（OneToOne）关系。</p>
<ol class="arabic simple">
<li><p>在单向(unidirectional)映射中，拥有方的表结构必须包含一个JoinColumn列，该JoinColumn列引用另一个表的ID；</p></li>
<li><p>在双向(bidirectional)映射中，Owner和非Owner都必须有&#64;OneToOne注解，其中非Owner实体必须包含mappedBy属性。</p></li>
</ol>
<div class="section" id="foreign-key">
<h4><span class="section-number">10.4.1.1. </span>Foreign Key<a class="headerlink" href="#foreign-key" title="Permalink to this headline">¶</a></h4>
<p>这是2个表的ER图：</p>
<a class="reference internal image-reference" href="../_images/entity_1_1.png"><img alt="../_images/entity_1_1.png" src="../_images/entity_1_1.png" style="width: 400px;" /></a>
<p>User表中有个外键字段“address_id”，它的值指向的是address表中的主键“id”。</p>
<div class="section" id="unidirectional">
<h5><span class="section-number">10.4.1.1.1. </span>Unidirectional<a class="headerlink" href="#unidirectional" title="Permalink to this headline">¶</a></h5>
<p>Unidirectional简单的讲，就是讲关系配置在Owner方。</p>
<div class="literal-block-wrapper docutils container" id="user-java">
<div class="code-block-caption"><span class="caption-text">User.java</span><a class="headerlink" href="#user-java" title="Permalink to this code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;users&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">AUTO</span><span class="p">)</span>
    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>
    <span class="c1">//...</span>

    <span class="nd">@OneToOne</span><span class="p">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">)</span>
    <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;address_id&quot;</span><span class="p">,</span> <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Address</span> <span class="n">address</span><span class="p">;</span>

    <span class="c1">// ... getters and setters</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="address-java">
<div class="code-block-caption"><span class="caption-text">Address.java</span><a class="headerlink" href="#address-java" title="Permalink to this code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;address&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">AUTO</span><span class="p">)</span>
    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>
    <span class="c1">//...</span>

    <span class="c1">//... getters and setters</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="bidirectional">
<h5><span class="section-number">10.4.1.1.2. </span>Bidirectional<a class="headerlink" href="#bidirectional" title="Permalink to this headline">¶</a></h5>
<p>Bidirectional关系需要双方都要配置，这里在Unidirectional的基础上需要另外在非Owner端添加&#64;OneToOne注解：</p>
<div class="literal-block-wrapper docutils container" id="address22-java">
<div class="code-block-caption"><span class="caption-text">Address.java</span><a class="headerlink" href="#address22-java" title="Permalink to this code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;address&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">AUTO</span><span class="p">)</span>
    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>
    <span class="c1">//...</span>

    <span class="nd">@OneToOne</span><span class="p">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">&quot;address&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">User</span> <span class="n">user</span><span class="p">;</span>

    <span class="c1">//... getters and setters</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>请注意：</p>
<ol class="arabic simple">
<li><p>&#64;JoinColumn注解在User端，表示User是Owner端；</p></li>
<li><p>&#64;JoinColumn注解中name属性用于定义外键的名称，这里表示User表中有个列名为“address_id”。 如果我们不提供名称，那么Hibernate将遵循一些 <a class="reference external" href="https://docs.jboss.org/hibernate/jpa/2.2/api/javax/persistence/JoinColumn.html">规则</a>  来选择默认名称。referencedColumnName = “id” 指示它映射到Address表中的主键“id”，默认是主键，因此referencedColumnName可以省略。</p></li>
<li><p>cascade=CascadeType.ALL 表示级联维护关系，如当删除 user，会级联删除 address。</p></li>
<li><p>在实践中，mappedBy属性很重要，如果不配置（如仅配置&#64;OneToOne），创建表时，会在Address表中额外添加”user_id“字段，同时2个实体的关系依然为Unidirectional。</p></li>
</ol>
</div>
<div class="section" id="crud">
<h5><span class="section-number">10.4.1.1.3. </span>CRUD操作<a class="headerlink" href="#crud" title="Permalink to this headline">¶</a></h5>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserRepository</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="p">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">findByName</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">);</span>

<span class="p">}</span>


<span class="kn">package</span> <span class="nn">com.example.demo.init</span><span class="p">;</span>

<span class="kn">import static</span> <span class="nn">org.junit.Assert.assertEquals</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.annotation.PostConstruct</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.example.demo.entity.Address</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.demo.entity.User</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.demo.repository.AddressRepository</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.example.demo.repository.UserRepository</span><span class="p">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostConstructExampleBean</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">PostConstructExampleBean</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">UserRepository</span> <span class="n">userRepository</span><span class="p">;</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">AddressRepository</span> <span class="n">addressRepository</span><span class="p">;</span>

    <span class="nd">@PostConstruct</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;init....&quot;</span><span class="p">);</span>

        <span class="c1">// given</span>
        <span class="n">User</span> <span class="n">user1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="p">();</span>
        <span class="n">user1</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">);</span>
        <span class="n">userRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">user1</span><span class="p">);</span>

        <span class="n">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="p">();</span>
        <span class="n">user2</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&quot;user2&quot;</span><span class="p">);</span>
        <span class="n">Address</span> <span class="n">address</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Address</span><span class="p">();</span>
        <span class="n">address</span><span class="p">.</span><span class="na">setStreet</span><span class="p">(</span><span class="s">&quot;Soft City No.1&quot;</span><span class="p">);</span>
        <span class="n">user2</span><span class="p">.</span><span class="na">setAddress</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>

        <span class="n">userRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">user2</span><span class="p">);</span>

        <span class="c1">// 查询user1</span>
        <span class="n">User</span> <span class="n">found1</span> <span class="o">=</span> <span class="n">userRepository</span><span class="p">.</span><span class="na">findByName</span><span class="p">(</span><span class="n">user1</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
        <span class="n">assertEquals</span><span class="p">(</span><span class="n">found1</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span> <span class="n">user1</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>

        <span class="c1">// 查询user2, 然后获得它的关联实体</span>
        <span class="n">User</span> <span class="n">found2</span> <span class="o">=</span> <span class="n">userRepository</span><span class="p">.</span><span class="na">findByName</span><span class="p">(</span><span class="n">user2</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
        <span class="n">assertEquals</span><span class="p">(</span><span class="n">found2</span><span class="p">.</span><span class="na">getAddress</span><span class="p">().</span><span class="na">getStreet</span><span class="p">(),</span> <span class="n">address</span><span class="p">.</span><span class="na">getStreet</span><span class="p">());</span>

        <span class="c1">// 查询Address, 然后获得它的关联实体</span>
        <span class="n">Address</span> <span class="n">found3</span> <span class="o">=</span> <span class="n">addressRepository</span><span class="p">.</span><span class="na">findByStreet</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="na">getStreet</span><span class="p">());</span>
        <span class="n">assertEquals</span><span class="p">(</span><span class="n">found3</span><span class="p">.</span><span class="na">getUser</span><span class="p">().</span><span class="na">getName</span><span class="p">(),</span> <span class="n">user2</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>

        <span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;init....over....&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>请注意：</p>
<ul class="simple">
<li><p>Unidirectional与Bidirectional的区别就是查询的方向，Unidirectional只能是Owner到非Owner端查询，Bidirectional是双向可以查询。</p></li>
<li><p>无论是Unidirectional还是Bidirectional，创建的表结构是相同的。</p></li>
</ul>
</div>
</div>
<div class="section" id="shared-primary-key">
<h4><span class="section-number">10.4.1.2. </span>Shared Primary Key(推荐)<a class="headerlink" href="#shared-primary-key" title="Permalink to this headline">¶</a></h4>
<p>在此例中，我们将创建Address表的主键列（user_id）作为User表的外键，而不是创建新的列address_id：</p>
<a class="reference internal image-reference" href="../_images/entity_1_2.png"><img alt="../_images/entity_1_2.png" src="../_images/entity_1_2.png" style="width: 400px;" /></a>
<p>此方案利用这些实体之间存在一对一的关系优化了表的存储空间。</p>
<div class="literal-block-wrapper docutils container" id="user2-java">
<div class="code-block-caption"><span class="caption-text">User.java</span><a class="headerlink" href="#user2-java" title="Permalink to this code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;users&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">AUTO</span><span class="p">)</span>
    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="c1">//...</span>

    <span class="nd">@OneToOne</span><span class="p">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Address</span> <span class="n">address</span><span class="p">;</span>

    <span class="c1">//... getters and setters</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="address2-java">
<div class="code-block-caption"><span class="caption-text">Address.java</span><a class="headerlink" href="#address2-java" title="Permalink to this code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;address&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="c1">//...</span>

    <span class="nd">@OneToOne</span>
    <span class="nd">@MapsId</span>
    <span class="kd">private</span> <span class="n">User</span> <span class="n">user</span><span class="p">;</span>

    <span class="c1">//... getters and setters</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<ol class="arabic simple">
<li><p>&#64;MapsId表示使用列id同时作为Address表的主键和外键，这里Address表的主键id不再是&#64;GeneratedValue声明了。</p></li>
<li><p>按照上一节讲的，mappedBy属性定义在非Owner方，因此，这里的Owner方变为Address实体了，因此，save操作的级联维护关系需要从Address实体方向开始。</p></li>
</ol>
<div class="section" id="id6">
<h5><span class="section-number">10.4.1.2.1. </span>CRUD操作<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@PostConstruct</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init2</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;init2....&quot;</span><span class="p">);</span>

    <span class="c1">// given</span>
    <span class="n">User</span> <span class="n">user1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="p">();</span>
    <span class="n">user1</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">);</span>
    <span class="n">userRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">user1</span><span class="p">);</span>

    <span class="n">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="p">();</span>
    <span class="n">user2</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&quot;user2&quot;</span><span class="p">);</span>
    <span class="n">Address</span> <span class="n">address</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Address</span><span class="p">();</span>
    <span class="n">address</span><span class="p">.</span><span class="na">setStreet</span><span class="p">(</span><span class="s">&quot;Soft City No.1&quot;</span><span class="p">);</span>
    <span class="n">address</span><span class="p">.</span><span class="na">setUser</span><span class="p">(</span><span class="n">user2</span><span class="p">);</span>

    <span class="n">addressRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>

    <span class="c1">// 查询user1</span>
    <span class="n">User</span> <span class="n">found1</span> <span class="o">=</span> <span class="n">userRepository</span><span class="p">.</span><span class="na">findByName</span><span class="p">(</span><span class="n">user1</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
    <span class="n">assertEquals</span><span class="p">(</span><span class="n">found1</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span> <span class="n">user1</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>

    <span class="c1">// 查询user2, 然后获得它的关联实体</span>
    <span class="n">User</span> <span class="n">found2</span> <span class="o">=</span> <span class="n">userRepository</span><span class="p">.</span><span class="na">findByName</span><span class="p">(</span><span class="n">user2</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
    <span class="n">assertEquals</span><span class="p">(</span><span class="n">found2</span><span class="p">.</span><span class="na">getAddress</span><span class="p">().</span><span class="na">getStreet</span><span class="p">(),</span> <span class="n">address</span><span class="p">.</span><span class="na">getStreet</span><span class="p">());</span>

    <span class="c1">// 查询Address, 然后获得它的关联实体</span>
    <span class="n">Address</span> <span class="n">found3</span> <span class="o">=</span> <span class="n">addressRepository</span><span class="p">.</span><span class="na">findByStreet</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="na">getStreet</span><span class="p">());</span>
    <span class="n">assertEquals</span><span class="p">(</span><span class="n">found3</span><span class="p">.</span><span class="na">getUser</span><span class="p">().</span><span class="na">getName</span><span class="p">(),</span> <span class="n">user2</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>

    <span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;init2....over....&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="join-table">
<h4><span class="section-number">10.4.1.3. </span>Join Table<a class="headerlink" href="#join-table" title="Permalink to this headline">¶</a></h4>
<p>到目前为止，我们已经讨论过的策略允许空值存在，使用联接表可以帮助我们消除这些空值：</p>
<a class="reference internal image-reference" href="../_images/entity_1_3.png"><img alt="../_images/entity_1_3.png" src="../_images/entity_1_3.png" style="width: 600px;" /></a>
<div class="literal-block-wrapper docutils container" id="employee-java">
<div class="code-block-caption"><span class="caption-text">Employee.java</span><a class="headerlink" href="#employee-java" title="Permalink to this code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;employee&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="p">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">AUTO</span><span class="p">)</span>
    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="c1">//...</span>

    <span class="nd">@OneToOne</span><span class="p">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">)</span>
    <span class="nd">@JoinTable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;emp_workstation&quot;</span><span class="p">,</span>
    <span class="n">joinColumns</span> <span class="o">=</span>
        <span class="p">{</span> <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;employee_id&quot;</span><span class="p">,</span> <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="p">},</span>
    <span class="n">inverseJoinColumns</span> <span class="o">=</span>
        <span class="p">{</span> <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;workstation_id&quot;</span><span class="p">,</span> <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="p">})</span>
    <span class="kd">private</span> <span class="n">WorkStation</span> <span class="n">workStation</span><span class="p">;</span>

    <span class="c1">//... getters and setters</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="workstation-java">
<div class="code-block-caption"><span class="caption-text">WorkStation.java</span><a class="headerlink" href="#workstation-java" title="Permalink to this code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;workstation&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WorkStation</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">AUTO</span><span class="p">)</span>
    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="c1">//...</span>

    <span class="nd">@OneToOne</span><span class="p">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">&quot;workStation&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Employee</span> <span class="n">employee</span><span class="p">;</span>

    <span class="c1">//... getters and setters</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<ol class="arabic simple">
<li><p>Employee is the owner of this relationship as we chose to use the &#64;JoinTable annotation on it.</p></li>
<li><p>如果不需要根据WorkStation级联查询Employee，可以注释掉WorkStation类中的“employee”字段（包括&#64;OneToOne注解）。</p></li>
</ol>
</div>
</div>
<div class="section" id="one-to-many">
<h3><span class="section-number">10.4.2. </span>one-to-many<a class="headerlink" href="#one-to-many" title="Permalink to this headline">¶</a></h3>
<p>JPA使用&#64;OneToMany和&#64;ManyToOne来标识一对多的双向关联。一端(Author)使用&#64;OneToMany,多端(Article)使用&#64;ManyToOne。</p>
<p>在JPA规范中，一对多的双向关系由多端(Article)来维护。就是说多端(Article)为关系 <code class="docutils literal notranslate"><span class="pre">维护端</span></code>，负责关系的增删改查。一端(Author)则为关系 <code class="docutils literal notranslate"><span class="pre">被维护端</span></code>，不能维护关系。</p>
<div class="literal-block-wrapper docutils container" id="author-java">
<div class="code-block-caption"><span class="caption-text">Author.java</span><a class="headerlink" href="#author-java" title="Permalink to this code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Author</span> <span class="p">{</span>
    <span class="nd">@Id</span> <span class="c1">// 主键</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span> <span class="c1">// 自增长策略</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span> <span class="c1">//id</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span><span class="c1">//姓名</span>

    <span class="nd">@OneToMany</span><span class="p">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">&quot;author&quot;</span><span class="p">,</span><span class="n">cascade</span><span class="o">=</span><span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">,</span><span class="n">fetch</span><span class="o">=</span><span class="n">FetchType</span><span class="p">.</span><span class="na">LAZY</span><span class="p">)</span>
    <span class="c1">//级联保存、更新、删除、刷新;延迟加载。当删除用户，会级联删除该用户的所有文章</span>
    <span class="c1">//拥有mappedBy注解的实体类为关系被维护端</span>
    <span class="c1">//mappedBy=&quot;author&quot;中的author是Article中的author属性</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Article</span><span class="o">&gt;</span> <span class="n">articleList</span><span class="p">;</span><span class="c1">//文章列表</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="article-java">
<div class="code-block-caption"><span class="caption-text">Article.java</span><a class="headerlink" href="#article-java" title="Permalink to this code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Article</span> <span class="p">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span> <span class="c1">// 自增长策略</span>
    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="p">;</span>

    <span class="c1">//可选属性optional=false,表示author不能为空。删除文章，不影响用户</span>
    <span class="nd">@ManyToOne</span><span class="p">(</span><span class="n">cascade</span><span class="o">=</span><span class="p">{</span><span class="n">CascadeType</span><span class="p">.</span><span class="na">MERGE</span><span class="p">,</span><span class="n">CascadeType</span><span class="p">.</span><span class="na">REFRESH</span><span class="p">},</span><span class="n">optional</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span>
    <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;author_id&quot;</span><span class="p">)</span><span class="c1">//设置在article表中的关联字段(外键)</span>
    <span class="kd">private</span> <span class="n">Author</span> <span class="n">author</span><span class="p">;</span><span class="c1">//所属作者</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id7">
<h4><span class="section-number">10.4.2.1. </span>Unidirectional<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Post&quot;</span><span class="p">)</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;post&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Post</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="p">;</span>

    <span class="nd">@OneToMany</span><span class="p">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">,</span> <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostComment</span><span class="o">&gt;</span> <span class="n">comments</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

    <span class="c1">//Constructors, getters and setters removed for brevity</span>
<span class="p">}</span>

<span class="nd">@Entity</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PostComment&quot;</span><span class="p">)</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;post_comment&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostComment</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">review</span><span class="p">;</span>

    <span class="c1">//Constructors, getters and setters removed for brevity</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>现在，我们尝试创建1条Post和3条PostComment记录：</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Post</span><span class="p">(</span><span class="s">&quot;First post&quot;</span><span class="p">);</span>

<span class="n">post</span><span class="p">.</span><span class="na">getComments</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
    <span class="k">new</span> <span class="n">PostComment</span><span class="p">(</span><span class="s">&quot;My first review&quot;</span><span class="p">)</span>
<span class="p">);</span>
<span class="n">post</span><span class="p">.</span><span class="na">getComments</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
    <span class="k">new</span> <span class="n">PostComment</span><span class="p">(</span><span class="s">&quot;My second review&quot;</span><span class="p">)</span>
<span class="p">);</span>
<span class="n">post</span><span class="p">.</span><span class="na">getComments</span><span class="p">().</span><span class="na">add</span><span class="p">(</span>
    <span class="k">new</span> <span class="n">PostComment</span><span class="p">(</span><span class="s">&quot;My third review&quot;</span><span class="p">)</span>
<span class="p">);</span>

<span class="n">entityManager</span><span class="p">.</span><span class="na">persist</span><span class="p">(</span><span class="n">post</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>底层的Hibernate将会执行下面的SQL：</p>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">insert</span> <span class="k">into</span> <span class="n">post</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;First post&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">post_comment</span> <span class="p">(</span><span class="n">review</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;My first review&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">post_comment</span> <span class="p">(</span><span class="n">review</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;My second review&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">post_comment</span> <span class="p">(</span><span class="n">review</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;My third review&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">post_post_comment</span> <span class="p">(</span><span class="n">Post_id</span><span class="p">,</span> <span class="n">comments_id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">post_post_comment</span> <span class="p">(</span><span class="n">Post_id</span><span class="p">,</span> <span class="n">comments_id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">post_post_comment</span> <span class="p">(</span><span class="n">Post_id</span><span class="p">,</span> <span class="n">comments_id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>从上面的SQL语句看，将会创建3张表，类似下图所示：</p>
<a class="reference internal image-reference" href="../_images/one-to-many_1.png"><img alt="../_images/one-to-many_1.png" src="../_images/one-to-many_1.png" style="width: 800px;" /></a>
<p>对于DBA，这看起来更像是多对多数据库关联，而不是一对多关系，而且效率也不高。 现在，有了三个表，而不是两个表，因此使用了不必要的存储空间。 现在，多了两个外键，有可能对这些外键建立索引，因此将需要两倍的内存来缓存此关联的索引。 此方案不是很好！</p>
</div>
<div class="section" id="unidirectional-with-joincolumn">
<h4><span class="section-number">10.4.2.2. </span>Unidirectional with &#64;JoinColumn<a class="headerlink" href="#unidirectional-with-joincolumn" title="Permalink to this headline">¶</a></h4>
<p>要解决上述额外的联接表问题，只需要添加&#64;JoinColumn：</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@OneToMany</span><span class="p">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">,</span> <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span>
<span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;post_id&quot;</span><span class="p">)</span>
<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostComment</span><span class="o">&gt;</span> <span class="n">comments</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
</pre></div>
</td></tr></table></div>
<p>有了此注释，持久化1个Post和3个PostComment实体时，将获得以下SQL输出：</p>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">insert</span> <span class="k">into</span> <span class="n">post</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;First post&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">post_comment</span> <span class="p">(</span><span class="n">review</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;My first review&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">post_comment</span> <span class="p">(</span><span class="n">review</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;My second review&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">post_comment</span> <span class="p">(</span><span class="n">review</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;My third review&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="k">update</span> <span class="n">post_comment</span> <span class="k">set</span> <span class="n">post_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">update</span> <span class="n">post_comment</span> <span class="k">set</span> <span class="n">post_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span>  <span class="mi">3</span>
<span class="k">update</span> <span class="n">post_comment</span> <span class="k">set</span> <span class="n">post_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span>  <span class="mi">4</span>
</pre></div>
</td></tr></table></div>
<p>好一点了，但是多了三个更新语句。</p>
<p>If you take a look at Hibernate flush order, you’ll see that the persist action is executed before the collection elements are handled. This way, Hibernate inserts the child records first without the Foreign Key since the child entity does not store this information. During the collection handling phase, the Foreign Key column is updated accordingly.</p>
<p>The same logic applies to collection state modifications, so when removing the firsts entry from the child collection:</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">post</span><span class="p">.</span><span class="na">getComments</span><span class="p">().</span><span class="na">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>Hibernate executes two statements instead of one:</p>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">update</span> <span class="n">post_comment</span> <span class="k">set</span> <span class="n">post_id</span> <span class="o">=</span> <span class="k">null</span> <span class="k">where</span> <span class="n">post_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">and</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">delete</span> <span class="k">from</span> <span class="n">post_comment</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="mi">2</span>
</pre></div>
</td></tr></table></div>
<p>Again, the parent entity state change is executed first, which triggers the child entity update. Afterward, when the collection is processed, the orphan removal action will execute the child row delete statement.</p>
</div>
<div class="section" id="id8">
<h4><span class="section-number">10.4.2.3. </span>Bidirectional(推荐)<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>The best way to map a &#64;OneToMany association is to rely on the &#64;ManyToOne side to propagate all entity state changes:</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Post&quot;</span><span class="p">)</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;post&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Post</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="p">;</span>

    <span class="nd">@OneToMany</span><span class="p">(</span>
        <span class="n">mappedBy</span> <span class="o">=</span> <span class="s">&quot;post&quot;</span><span class="p">,</span>
        <span class="n">cascade</span> <span class="o">=</span> <span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">,</span>
        <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">)</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">PostComment</span><span class="o">&gt;</span> <span class="n">comments</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

    <span class="c1">//Constructors, getters and setters removed for brevity</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addComment</span><span class="p">(</span><span class="n">PostComment</span> <span class="n">comment</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">comments</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">comment</span><span class="p">);</span>
        <span class="n">comment</span><span class="p">.</span><span class="na">setPost</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeComment</span><span class="p">(</span><span class="n">PostComment</span> <span class="n">comment</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">comments</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">comment</span><span class="p">);</span>
        <span class="n">comment</span><span class="p">.</span><span class="na">setPost</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Entity</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PostComment&quot;</span><span class="p">)</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;post_comment&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostComment</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">review</span><span class="p">;</span>

    <span class="nd">@ManyToOne</span><span class="p">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="p">.</span><span class="na">LAZY</span><span class="p">)</span>
    <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;post_id&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Post</span> <span class="n">post</span><span class="p">;</span>

    <span class="c1">//Constructors, getters and setters removed for brevity</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="p">(</span><span class="n">Object</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">PostComment</span> <span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">id</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">id</span><span class="p">.</span><span class="na">equals</span><span class="p">(((</span><span class="n">PostComment</span><span class="p">)</span> <span class="n">o</span><span class="p">).</span><span class="na">getId</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">31</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>There are several things to note on the aforementioned mapping:</p>
<ol class="arabic simple">
<li><p>The &#64;ManyToOne association uses FetchType.LAZY because, otherwise, we’d fall back to EAGER fetching which is bad for performance.</p></li>
<li><p>The parent entity, Post, features two utility methods (e.g. addComment and removeComment) which are used to synchronize both sides of the bidirectional association. You should always provide these methods whenever you are working with a bidirectional association as, otherwise, you risk very subtle state propagation issues.</p></li>
<li><p>The child entity, PostComment, implement the equals and hashCode methods. Since we cannot rely on a natural identifier for equality checks, we need to use the entity identifier instead. However, you need to do it properly so that equality is consistent across all entity state transitions. Because we rely on equality for the removeComment, it’s good practice to override equals and hashCode for the child entity in a bidirectional association.</p></li>
</ol>
<p>If we persist three PostComment(s):</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Post</span><span class="p">(</span><span class="s">&quot;First post&quot;</span><span class="p">);</span>

<span class="n">post</span><span class="p">.</span><span class="na">addComment</span><span class="p">(</span>
    <span class="k">new</span> <span class="n">PostComment</span><span class="p">(</span><span class="s">&quot;My first review&quot;</span><span class="p">)</span>
<span class="p">);</span>
<span class="n">post</span><span class="p">.</span><span class="na">addComment</span><span class="p">(</span>
    <span class="k">new</span> <span class="n">PostComment</span><span class="p">(</span><span class="s">&quot;My second review&quot;</span><span class="p">)</span>
<span class="p">);</span>
<span class="n">post</span><span class="p">.</span><span class="na">addComment</span><span class="p">(</span>
    <span class="k">new</span> <span class="n">PostComment</span><span class="p">(</span><span class="s">&quot;My third review&quot;</span><span class="p">)</span>
<span class="p">);</span>

<span class="n">entityManager</span><span class="p">.</span><span class="na">persist</span><span class="p">(</span><span class="n">post</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>Hibernate generates just one SQL statement for each persisted PostComment entity:</p>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">insert</span> <span class="k">into</span> <span class="n">post</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;First post&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">post_comment</span> <span class="p">(</span><span class="n">post_id</span><span class="p">,</span> <span class="n">review</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;My first review&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">post_comment</span> <span class="p">(</span><span class="n">post_id</span><span class="p">,</span> <span class="n">review</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;My second review&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">post_comment</span> <span class="p">(</span><span class="n">post_id</span><span class="p">,</span> <span class="n">review</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;My third review&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>If we remove a PostComment:</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">entityManager</span><span class="p">.</span><span class="na">find</span><span class="p">(</span> <span class="n">Post</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="mi">1L</span> <span class="p">);</span>
<span class="n">PostComment</span> <span class="n">comment1</span> <span class="o">=</span> <span class="n">post</span><span class="p">.</span><span class="na">getComments</span><span class="p">().</span><span class="na">get</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>

<span class="n">post</span><span class="p">.</span><span class="na">removeComment</span><span class="p">(</span><span class="n">comment1</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>There’s only one delete SQL statement that gets executed:</p>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">delete</span> <span class="k">from</span> <span class="n">post_comment</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</td></tr></table></div>
<p>So, the bidirectional &#64;OneToMany association is the best way to map a one-to-many database relationship when we really need the collection on the parent side of the association.</p>
</div>
</div>
<div class="section" id="many-to-many">
<h3><span class="section-number">10.4.3. </span>many-to-many<a class="headerlink" href="#many-to-many" title="Permalink to this headline">¶</a></h3>
<p>类似上面的3表关联。</p>
</div>
</div>
<div class="section" id="h2">
<h2><span class="section-number">10.5. </span>H2<a class="headerlink" href="#h2" title="Permalink to this headline">¶</a></h2>
<div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.h2database<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>h2<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="id9">
<h3><span class="section-number">10.5.1. </span>默认配置<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>启动Spring Boot时，控制台显示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">H2</span> <span class="n">console</span> <span class="n">available</span> <span class="n">at</span> <span class="s1">&#39;/h2-console&#39;</span><span class="o">.</span> <span class="n">Database</span> <span class="n">available</span> <span class="n">at</span> <span class="s1">&#39;jdbc:h2:mem:testdb&#39;</span>
</pre></div>
</div>
<p>Spring Boot默认的完整H2配置如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spring</span><span class="o">.</span><span class="n">datasource</span><span class="o">.</span><span class="n">url</span><span class="o">=</span><span class="n">jdbc</span><span class="p">:</span><span class="n">h2</span><span class="p">:</span><span class="n">mem</span><span class="p">:</span><span class="n">testdb</span>
<span class="n">spring</span><span class="o">.</span><span class="n">datasource</span><span class="o">.</span><span class="n">driverClassName</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">h2</span><span class="o">.</span><span class="n">Driver</span>
<span class="n">spring</span><span class="o">.</span><span class="n">datasource</span><span class="o">.</span><span class="n">username</span><span class="o">=</span><span class="n">sa</span>
<span class="n">spring</span><span class="o">.</span><span class="n">datasource</span><span class="o">.</span><span class="n">password</span><span class="o">=</span><span class="n">password</span>
<span class="n">spring</span><span class="o">.</span><span class="n">jpa</span><span class="o">.</span><span class="n">database</span><span class="o">-</span><span class="n">platform</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">hibernate</span><span class="o">.</span><span class="n">dialect</span><span class="o">.</span><span class="n">H2Dialect</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3><span class="section-number">10.5.2. </span>更改H2控制台的路径<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>可以通过spring.h2.console.enabled来禁用H2控制台:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spring</span><span class="o">.</span><span class="n">h2</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">false</span>
</pre></div>
</div>
<p>默认情况下，控制台位于/h2-console。您可以使用spring.h2.console.path属性自定义控制台的路径。</p>
<p>可以设置一个固定路径，通过指定spring.datasource.url属性:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spring</span><span class="o">.</span><span class="n">datasource</span><span class="o">.</span><span class="n">url</span><span class="o">=</span><span class="n">jdbc</span><span class="p">:</span><span class="n">h2</span><span class="p">:</span><span class="n">file</span><span class="p">:</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">demo</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id11">
<h2><span class="section-number">10.6. </span>初始化数据库数据<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>add a data.sql file in src/main/resources:</p>
<div class="highlight-sql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">billionaires</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">billionaires</span> <span class="p">(</span>
<span class="n">id</span> <span class="nb">INT</span> <span class="n">AUTO_INCREMENT</span>  <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
<span class="n">first_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">last_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">career</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">billionaires</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">career</span><span class="p">)</span> <span class="k">VALUES</span>
<span class="p">(</span><span class="s1">&#39;Aliko&#39;</span><span class="p">,</span> <span class="s1">&#39;Dangote&#39;</span><span class="p">,</span> <span class="s1">&#39;Billionaire Industrialist&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Bill&#39;</span><span class="p">,</span> <span class="s1">&#39;Gates&#39;</span><span class="p">,</span> <span class="s1">&#39;Billionaire Tech Entrepreneur&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Folrunsho&#39;</span><span class="p">,</span> <span class="s1">&#39;Alakija&#39;</span><span class="p">,</span> <span class="s1">&#39;Billionaire Oil Magnate&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id12">
<h2><span class="section-number">10.7. </span>参考<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.baeldung.com/jpa-one-to-one">https://www.baeldung.com/jpa-one-to-one</a></p></li>
<li><p><a class="reference external" href="https://vladmihalcea.com/the-best-way-to-map-a-onetomany-association-with-jpa-and-hibernate/">https://vladmihalcea.com/the-best-way-to-map-a-onetomany-association-with-jpa-and-hibernate/</a></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="jpa.html" class="btn btn-neutral float-right" title="11. Spring Data JPA" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pages.html" class="btn btn-neutral float-left" title="9. Spring Boot Pages" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Murphy

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>